<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PENSTATION</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#111;color:#eee;font-family:monospace;font-size:14px;padding:1rem}
h1{color:#0f0;margin-bottom:1rem}
h2{color:#0ff;margin:1rem 0 .5rem;font-size:1rem;border-bottom:1px solid #333;padding-bottom:.3rem}
button{background:#222;color:#0f0;border:1px solid #0f0;padding:6px 14px;cursor:pointer;font-family:monospace;font-size:13px;margin:3px}
button:hover{background:#0f0;color:#000}
button:disabled{opacity:.4;cursor:wait}
button.red{border-color:#f33;color:#f33}
button.red:hover{background:#f33;color:#000}
button.yellow{border-color:#ff0;color:#ff0}
button.yellow:hover{background:#ff0;color:#000}
.section{background:#1a1a1a;border:1px solid #333;padding:.8rem;margin-bottom:.8rem;border-radius:4px}
.output{background:#000;border:1px solid #333;padding:.5rem;margin-top:.5rem;max-height:400px;overflow:auto;font-size:12px;white-space:pre-wrap;word-break:break-all;border-radius:2px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:.8rem}
.wifi-net{display:flex;justify-content:space-between;align-items:center;padding:6px 8px;border-bottom:1px solid #222}
.wifi-net:hover{background:#1a1a1a}
.signal{color:#0f0}
.security{color:#ff0;font-size:11px}
.connected{color:#0f0;font-weight:bold}
input{background:#000;color:#eee;border:1px solid #333;padding:5px 8px;font-family:monospace;font-size:13px;width:200px}
input:focus{border-color:#0ff;outline:none}
.status{padding:4px 8px;border-radius:2px;font-size:12px;display:inline-block;margin:3px}
.status.ok{background:#040;color:#0f0}
.status.err{background:#400;color:#f33}
.status.warn{background:#330;color:#ff0}
table{width:100%;border-collapse:collapse;font-size:12px}
th{text-align:left;color:#888;padding:4px 8px;border-bottom:1px solid #333}
td{padding:4px 8px;border-bottom:1px solid #222}
@media(max-width:700px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<h1>PENSTATION</h1>
<div id="status-bar">
  <span class="status" id="svc-status">...</span>
  <span id="time"></span>
</div>

<div class="grid">
  <!-- WiFi -->
  <div class="section">
    <h2>WiFi</h2>
    <div id="wifi-status">...</div>
    <br>
    <button onclick="wifiScan()">Scan Networks</button>
    <button class="red" onclick="wifiDisconnect()">Disconnect</button>
    <div id="wifi-networks"></div>
    <div id="wifi-connect-form" style="display:none;margin-top:.5rem">
      <b id="wifi-target"></b><br>
      <input type="password" id="wifi-pass" placeholder="Password">
      <button onclick="wifiConnect()">Connect</button>
      <button class="red" onclick="document.getElementById('wifi-connect-form').style.display='none'">Cancel</button>
    </div>
  </div>

  <!-- Adapters -->
  <div class="section">
    <h2>WiFi Adapters</h2>
    <button onclick="loadAdapters()">Refresh</button>
    <div id="adapters-output" class="output">Click Refresh</div>
  </div>

  <!-- Network Scan -->
  <div class="section">
    <h2>Network Scan</h2>
    <button onclick="triggerScan()">Trigger Scan</button>
    <button onclick="loadHosts()">Load Hosts</button>
    <button onclick="loadStats()">Stats</button>
    <div id="hosts-output" class="output">Click Load Hosts</div>
  </div>

  <!-- Vulnerabilities -->
  <div class="section">
    <h2>Vulnerabilities</h2>
    <button onclick="loadVulns()">All Vulns</button>
    <button onclick="loadVulns('critical')">Critical</button>
    <button onclick="loadVulns('high')">High</button>
    <button onclick="loadAlerts()">Alerts</button>
    <div id="vulns-output" class="output">Click to load</div>
  </div>

  <!-- WiFi Pentesting -->
  <div class="section" style="grid-column:1/3">
    <h2>WiFi Pentesting</h2>

    <!-- Monitor Mode -->
    <div style="margin-bottom:.8rem">
      <b style="color:#ff0">Monitor Mode:</b>
      Interface: <input type="text" id="mon-iface" value="wlan1" style="width:80px">
      <button onclick="monStart()">Start Monitor</button>
      <button class="red" onclick="monStop()">Stop Monitor</button>
      <span id="mon-status" style="margin-left:8px"></span>
    </div>

    <!-- Airodump Scan -->
    <div style="margin-bottom:.8rem">
      <b style="color:#ff0">Airodump Scan:</b>
      Monitor IF: <input type="text" id="airo-iface" value="wlan1mon" style="width:100px">
      Duration: <input type="number" id="airo-dur" value="20" style="width:50px">s
      Channel: <input type="number" id="airo-ch" value="0" style="width:50px">
      <button onclick="airodumpScan()">Scan</button>
    </div>
    <div id="airo-output" class="output" style="max-height:250px">Run airodump scan to see APs and clients</div>

    <!-- Deauth -->
    <div style="margin-top:.8rem;margin-bottom:.8rem">
      <b style="color:#f33">Deauth Attack:</b>
      Mon IF: <input type="text" id="deauth-iface" value="wlan1mon" style="width:100px">
      BSSID: <input type="text" id="deauth-bssid" placeholder="AA:BB:CC:DD:EE:FF" style="width:150px">
      Client: <input type="text" id="deauth-client" value="FF:FF:FF:FF:FF:FF" style="width:150px">
      Count: <input type="number" id="deauth-count" value="10" style="width:50px">
      <button class="red" onclick="doDeauth()">DEAUTH</button>
    </div>

    <!-- Handshake Capture -->
    <div style="margin-bottom:.8rem">
      <b style="color:#ff0">Handshake Capture:</b>
      Mon IF: <input type="text" id="hs-iface" value="wlan1mon" style="width:100px">
      BSSID: <input type="text" id="hs-bssid" placeholder="AA:BB:CC:DD:EE:FF" style="width:150px">
      Channel: <input type="number" id="hs-ch" value="1" style="width:50px">
      Timeout: <input type="number" id="hs-timeout" value="60" style="width:50px">s
      <button class="yellow" onclick="captureHS()">Capture</button>
    </div>

    <!-- WPS Attack -->
    <div style="margin-bottom:.8rem">
      <b style="color:#ff0">WPS Attack:</b>
      Mon IF: <input type="text" id="wps-iface" value="wlan1mon" style="width:100px">
      BSSID: <input type="text" id="wps-bssid" placeholder="AA:BB:CC:DD:EE:FF" style="width:150px">
      Channel: <input type="number" id="wps-ch" value="1" style="width:50px">
      <select id="wps-method" style="background:#000;color:#eee;border:1px solid #333;padding:4px;font-family:monospace">
        <option value="reaver">Reaver</option>
        <option value="bully">Bully</option>
      </select>
      <label style="color:#888"><input type="checkbox" id="wps-pixie" checked> Pixie-Dust</label>
      <button class="yellow" onclick="doWPS()">Attack WPS</button>
    </div>

    <!-- Crack -->
    <div style="margin-bottom:.8rem">
      <b style="color:#ff0">Crack Handshake:</b>
      PCAP: <input type="text" id="crack-pcap" placeholder="/home/kali/penstation/captures/hs_*.cap" style="width:300px">
      Wordlist: <input type="text" id="crack-wl" value="/usr/share/wordlists/rockyou.txt" style="width:250px">
      <button class="yellow" onclick="doCrack()">Crack</button>
    </div>

    <!-- Controls -->
    <div style="margin-bottom:.5rem">
      <button onclick="loadAttacks()">Running Attacks</button>
      <button class="red" onclick="stopAll()">Stop All Attacks</button>
      <button onclick="loadCaptures()">List Captures</button>
    </div>
    <div id="attack-output" class="output">Attack results will appear here</div>
  </div>

  <!-- Scans History -->
  <div class="section">
    <h2>Scan History</h2>
    <button onclick="loadScans()">Load Scans</button>
    <div id="scans-output" class="output">Click to load</div>
  </div>

  <!-- Raw API -->
  <div class="section">
    <h2>Raw API Call</h2>
    <input type="text" id="api-url" value="/api/stats" style="width:70%">
    <button onclick="rawApi()">GET</button>
    <div id="raw-output" class="output">Enter endpoint and click GET</div>
  </div>
</div>

<script>
const API = '';
let wifiTargetSsid = '';

// Helpers
async function api(url, opts) {
  try {
    const res = await fetch(API + url, opts);
    return await res.json();
  } catch(e) {
    return {error: e.message};
  }
}

function $(id) { return document.getElementById(id); }

function json(data) { return JSON.stringify(data, null, 2); }

function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

// Status
async function checkStatus() {
  try {
    const data = await api('/api/stats');
    $('svc-status').className = 'status ok';
    $('svc-status').textContent = 'ONLINE';
  } catch {
    $('svc-status').className = 'status err';
    $('svc-status').textContent = 'OFFLINE';
  }
}

// WiFi Status
async function loadWifiStatus() {
  const data = await api('/api/wifi/status');
  if (data.connected) {
    $('wifi-status').innerHTML = `<span class="connected">Connected:</span> ${esc(data.ssid||'')} | Signal: ${data.signal||'?'}% | IP: ${data.ip||'?'}`;
  } else {
    $('wifi-status').innerHTML = '<span style="color:#f33">Disconnected</span>';
  }
}

// WiFi Scan
async function wifiScan() {
  $('wifi-networks').innerHTML = '<div style="color:#888;padding:8px">Scanning...</div>';
  const data = await api('/api/wifi/scan');
  const nets = data.networks || data || [];
  if (!nets.length) {
    $('wifi-networks').innerHTML = '<div style="color:#f33;padding:8px">No networks found</div>';
    return;
  }
  $('wifi-networks').innerHTML = nets.map(n =>
    `<div class="wifi-net" onclick="selectWifi('${esc(n.ssid)}')">
      <span>${n.connected?'<span class="connected">[*] </span>':''}${esc(n.ssid)} <span class="security">${esc(n.security||'')}</span></span>
      <span class="signal">${n.signal}%</span>
    </div>`
  ).join('');
}

function selectWifi(ssid) {
  wifiTargetSsid = ssid;
  $('wifi-target').textContent = 'Connect to: ' + ssid;
  $('wifi-pass').value = '';
  $('wifi-connect-form').style.display = 'block';
  $('wifi-pass').focus();
}

async function wifiConnect() {
  const pass = $('wifi-pass').value;
  const data = await api('/api/wifi/connect', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ssid: wifiTargetSsid, password: pass})
  });
  alert(data.success ? 'Connected!' : 'Failed: ' + (data.error||'unknown'));
  $('wifi-connect-form').style.display = 'none';
  loadWifiStatus();
}

async function wifiDisconnect() {
  const data = await api('/api/wifi/disconnect', {method:'POST'});
  alert(data.success ? 'Disconnected' : 'Failed');
  loadWifiStatus();
}

// Adapters
async function loadAdapters() {
  const data = await api('/api/wifi/adapters');
  if (!data.length) {
    $('adapters-output').textContent = 'No adapters found';
    return;
  }
  let html = '<table><tr><th>Interface</th><th>Driver</th><th>Monitor</th><th>Injection</th><th>Role</th></tr>';
  data.forEach(a => {
    html += `<tr>
      <td>${a.interface}</td>
      <td>${a.driver||'?'}</td>
      <td>${a.supports_monitor?'YES':'NO'}</td>
      <td>${a.supports_injection?'YES':'NO'}</td>
      <td>${a.role||'-'}</td>
    </tr>`;
  });
  html += '</table>';
  $('adapters-output').innerHTML = html;
}

// Hosts
async function loadHosts() {
  const data = await api('/api/hosts');
  if (!data.length) {
    $('hosts-output').textContent = 'No hosts found';
    return;
  }
  let html = '<table><tr><th>IP</th><th>Hostname</th><th>OS</th><th>Ports</th><th>Risk</th><th>Vulns</th></tr>';
  data.forEach(h => {
    const v = h.vulns||{};
    html += `<tr>
      <td>${h.ip}</td>
      <td>${h.hostname||'-'}</td>
      <td>${h.os_name||'?'}</td>
      <td>${h.ports_count||0}</td>
      <td>${h.risk_score||0}</td>
      <td>C:${v.critical||0} H:${v.high||0} M:${v.medium||0}</td>
    </tr>`;
  });
  html += '</table>';
  $('hosts-output').innerHTML = html;
}

async function loadStats() {
  const data = await api('/api/stats');
  $('hosts-output').textContent = json(data);
}

async function triggerScan() {
  const data = await api('/api/scan/trigger', {method:'POST'});
  $('hosts-output').textContent = json(data);
}

// Vulns
async function loadVulns(sev) {
  const url = sev ? `/api/vulns?severity=${sev}` : '/api/vulns';
  const data = await api(url);
  $('vulns-output').textContent = json(data);
}

async function loadAlerts() {
  const data = await api('/api/alerts');
  $('vulns-output').textContent = json(data);
}

// Scans
async function loadScans() {
  const data = await api('/api/scans');
  $('scans-output').textContent = json(data);
}

// Raw API
async function rawApi() {
  const url = $('api-url').value;
  const data = await api(url);
  $('raw-output').textContent = json(data);
}

// ── WiFi Pentesting ──────────────────────────
async function monStart() {
  const iface = $('mon-iface').value;
  $('mon-status').textContent = 'Starting...';
  $('mon-status').style.color = '#ff0';
  const data = await api('/api/wifi/monitor/start', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({interface: iface, enable: true})
  });
  if (data.success) {
    $('mon-status').textContent = 'ON: ' + (data.monitor_interface||'');
    $('mon-status').style.color = '#0f0';
    $('airo-iface').value = data.monitor_interface || iface+'mon';
    $('deauth-iface').value = data.monitor_interface || iface+'mon';
    $('hs-iface').value = data.monitor_interface || iface+'mon';
    $('wps-iface').value = data.monitor_interface || iface+'mon';
  } else {
    $('mon-status').textContent = 'FAILED';
    $('mon-status').style.color = '#f33';
  }
}

async function monStop() {
  const iface = $('airo-iface').value || $('mon-iface').value + 'mon';
  $('mon-status').textContent = 'Stopping...';
  const data = await api('/api/wifi/monitor/stop', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({interface: iface, enable: false})
  });
  $('mon-status').textContent = data.success ? 'OFF' : 'FAILED';
  $('mon-status').style.color = data.success ? '#888' : '#f33';
}

async function airodumpScan() {
  const iface = $('airo-iface').value;
  const dur = parseInt($('airo-dur').value) || 20;
  const ch = parseInt($('airo-ch').value) || 0;
  $('airo-output').textContent = `Scanning for ${dur}s on ${iface}...`;
  const data = await api('/api/wifi/airodump', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({interface: iface, duration: dur, channel: ch})
  });
  const nets = data.networks || [];
  const clients = data.clients || [];
  if (!nets.length && !clients.length) {
    $('airo-output').textContent = 'No results (check monitor mode)';
    return;
  }
  let html = '<b style="color:#0ff">APs (' + nets.length + '):</b>\n';
  html += '<table><tr><th>BSSID</th><th>CH</th><th>ENC</th><th>PWR</th><th>Data</th><th>SSID</th><th></th></tr>';
  nets.forEach(n => {
    html += `<tr>
      <td>${n.bssid}</td><td>${n.channel}</td><td>${n.encryption}</td>
      <td>${n.power}</td><td>${n.data_packets}</td><td>${n.ssid||'(hidden)'}</td>
      <td><button onclick="targetAP('${n.bssid}',${n.channel},'${esc(n.ssid)}')" style="padding:2px 6px;font-size:11px">TARGET</button></td>
    </tr>`;
  });
  html += '</table>';
  if (clients.length) {
    html += '\n<b style="color:#0ff">Clients (' + clients.length + '):</b>\n';
    html += '<table><tr><th>MAC</th><th>PWR</th><th>Packets</th><th>AP BSSID</th><th>Probes</th></tr>';
    clients.forEach(c => {
      html += `<tr><td>${c.mac}</td><td>${c.power}</td><td>${c.packets}</td><td>${c.bssid}</td><td>${c.probes||''}</td></tr>`;
    });
    html += '</table>';
  }
  $('airo-output').innerHTML = html;
}

function targetAP(bssid, channel, ssid) {
  $('deauth-bssid').value = bssid;
  $('hs-bssid').value = bssid;
  $('hs-ch').value = channel;
  $('wps-bssid').value = bssid;
  $('wps-ch').value = channel;
  $('attack-output').textContent = `Target set: ${ssid} (${bssid}) CH ${channel}`;
}

async function doDeauth() {
  const data = await api('/api/wifi/deauth', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      interface: $('deauth-iface').value,
      target_bssid: $('deauth-bssid').value,
      client_mac: $('deauth-client').value,
      count: parseInt($('deauth-count').value) || 10,
    })
  });
  $('attack-output').textContent = json(data);
}

async function captureHS() {
  $('attack-output').textContent = 'Capturing handshake... (this may take up to ' + $('hs-timeout').value + 's)';
  const data = await api('/api/wifi/handshake', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      interface: $('hs-iface').value,
      target_bssid: $('hs-bssid').value,
      channel: parseInt($('hs-ch').value),
      timeout: parseInt($('hs-timeout').value) || 60,
      deauth: true,
    })
  });
  $('attack-output').textContent = json(data);
  if (data.pcap_path) $('crack-pcap').value = data.pcap_path;
}

async function doWPS() {
  $('attack-output').textContent = 'Running WPS attack...';
  const data = await api('/api/wifi/wps', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      interface: $('wps-iface').value,
      target_bssid: $('wps-bssid').value,
      channel: parseInt($('wps-ch').value),
      method: $('wps-method').value,
      pixie_dust: $('wps-pixie').checked,
    })
  });
  $('attack-output').textContent = json(data);
}

async function doCrack() {
  $('attack-output').textContent = 'Cracking handshake with wordlist...';
  const data = await api('/api/wifi/crack', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      pcap_path: $('crack-pcap').value,
      wordlist: $('crack-wl').value,
    })
  });
  $('attack-output').textContent = json(data);
}

async function loadAttacks() {
  const data = await api('/api/wifi/attacks');
  $('attack-output').textContent = json(data);
}

async function stopAll() {
  const data = await api('/api/wifi/attacks/stop', {method:'POST'});
  $('attack-output').textContent = json(data);
}

async function loadCaptures() {
  const data = await api('/api/wifi/captures');
  $('attack-output').textContent = json(data);
}

// Clock
setInterval(() => {
  $('time').textContent = new Date().toLocaleTimeString();
}, 1000);

// Init
checkStatus();
loadWifiStatus();
setInterval(checkStatus, 30000);
setInterval(loadWifiStatus, 20000);
</script>
</body>
</html>
